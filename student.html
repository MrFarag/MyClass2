<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MyClass2 - Ø§Ù„Ø·Ø§Ù„Ø¨</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --blue:#3b82f6; --red:#ef4444; --green:#22c55e;
            --yellow:#f59e0b; --dark:#0f172a; --card:#1e293b;
            --border:#334155; --muted:#475569; --dim:#94a3b8;
        }
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Cairo',sans-serif; }
        html, body { height:100%; overflow:hidden; background:var(--dark); color:#fff; }

        /* â”€â”€ JOIN â”€â”€ */
        #overlay {
            position:fixed; inset:0; background:var(--dark);
            display:flex; align-items:center; justify-content:center; z-index:9999;
        }
        .jcard {
            background:var(--card); border:1px solid var(--border);
            border-radius:24px; padding:40px 28px; width:310px; text-align:center;
        }
        .jlogo { font-size:30px; font-weight:900; color:var(--blue); }
        .jlogo span { color:#fff; }
        .jsub { font-size:13px; color:var(--dim); margin:6px 0 24px; }
        .jcard input {
            width:100%; padding:12px 16px; background:var(--border);
            border:1px solid var(--muted); border-radius:12px; color:#fff;
            font-size:15px; font-family:'Cairo',sans-serif; text-align:center;
            outline:none; margin-bottom:12px;
        }
        .jcard input:focus { border-color:var(--blue); }
        .jbtn {
            width:100%; padding:12px; background:var(--blue); border:none;
            border-radius:12px; color:#fff; font-size:15px; font-weight:700;
            cursor:pointer; font-family:'Cairo',sans-serif;
        }
        .jbtn:disabled { opacity:.5; }
        .jwait { display:none; margin-top:14px; color:var(--yellow); font-size:13px; }

        /* â”€â”€ SHELL â”€â”€ */
        #app {
            position:fixed; inset:0;
            display:flex; flex-direction:column;
        }

        /* â”€â”€ TOPBAR â”€â”€ */
        .topbar {
            background:var(--card); height:48px; padding:0 12px;
            display:flex; align-items:center; justify-content:space-between;
            border-bottom:2px solid var(--border); flex-shrink:0;
            /* safe-area for notch */
            padding-top: env(safe-area-inset-top);
        }
        .logo { font-size:17px; font-weight:900; color:var(--blue); }
        .logo span { color:#fff; }
        .topright { display:flex; align-items:center; gap:8px; }
        .nchip { background:var(--border); padding:4px 12px; border-radius:20px; font-size:12px; }
        .hbtn {
            width:36px; height:36px; border-radius:50%; border:none;
            background:var(--border); color:#fff; cursor:pointer; font-size:14px;
            display:flex; align-items:center; justify-content:center;
        }
        .hbtn.up { background:var(--yellow); animation:pulse 1.5s infinite; }
        @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.6} }

        /* â”€â”€ BOARDS â”€â”€ */
        .boards {
            flex:1; display:flex; flex-direction:column;
            overflow:hidden; min-height:0; padding:6px; gap:6px;
        }
        .bcard {
            flex:1; background:var(--card); border-radius:12px;
            border:1px solid var(--border); display:flex; flex-direction:column;
            overflow:hidden; min-height:0;
        }
        .bhead {
            height:34px; padding:0 10px; background:var(--border);
            display:flex; align-items:center; justify-content:space-between;
            flex-shrink:0; border-bottom:2px solid transparent;
        }
        .tb-board .bhead { border-bottom-color:var(--red); }
        .sb-board .bhead { border-bottom-color:var(--blue); }
        .bhtitle { font-size:12px; font-weight:700; display:flex; align-items:center; gap:6px; }
        .carea {
            flex:1; background:#fff; position:relative;
            overflow:hidden; min-height:0;
        }
        .carea canvas {
            display:block;
            width:100% !important; height:100% !important;
            touch-action:none;
        }
        #sc { cursor:crosshair; }
        .live-badge {
            background:var(--red); padding:2px 7px; border-radius:8px;
            font-size:10px; display:none; align-items:center; gap:4px;
        }
        .live-badge.on { display:flex; }

        /* â”€â”€ MIC BAR (separate fixed row above toolbar) â”€â”€ */
        .micbar {
            background:var(--card); border-top:1px solid var(--border);
            padding:6px 12px; display:flex; align-items:center; gap:10px;
            flex-shrink:0;
        }
        .micbtn {
            width:42px; height:42px; border-radius:50%; border:none;
            background:var(--border); color:var(--dim);
            cursor:pointer; font-size:18px;
            display:flex; align-items:center; justify-content:center;
            flex-shrink:0;
        }
        .micbtn.req { background:rgba(245,158,11,.2); color:var(--yellow); animation:pulse 1s infinite; }
        .micbtn.spk { background:var(--green); color:#fff; animation:pulse 1s infinite; }
        .miclbl { font-size:12px; color:var(--dim); flex:1; }
        .volrow { display:flex; align-items:center; gap:6px; margin-right:auto; }
        .volrow i { font-size:12px; color:var(--dim); }
        input[type=range].vol {
            width:70px; height:4px; -webkit-appearance:none;
            background:var(--muted); border-radius:2px;
        }
        input[type=range].vol::-webkit-slider-thumb {
            -webkit-appearance:none; width:14px; height:14px;
            background:var(--blue); border-radius:50%; cursor:pointer;
        }

        /* â”€â”€ TOOLBAR â”€â”€ */
        .toolbar {
            background:var(--card); border-top:1px solid var(--border);
            padding:6px 10px; display:flex; align-items:center; gap:6px;
            flex-wrap:nowrap; flex-shrink:0; overflow-x:auto;
        }
        .tsep { width:1px; height:32px; background:var(--border); flex-shrink:0; }
        .tg { display:flex; gap:3px; flex-shrink:0; }
        .tt {
            width:36px; height:36px; border-radius:8px;
            border:1px solid transparent; background:var(--border);
            color:var(--dim); cursor:pointer; font-size:14px;
            display:flex; align-items:center; justify-content:center;
        }
        .tt.on { background:var(--blue); color:#fff; }
        .clrs { display:flex; gap:4px; align-items:center; flex-shrink:0; }
        .cl {
            width:26px; height:26px; border-radius:50%;
            cursor:pointer; border:2px solid transparent;
        }
        .cl.on { border-color:#fff; }
        .szs { display:flex; gap:3px; background:var(--border); padding:3px 6px; border-radius:8px; flex-shrink:0; }
        .sz { border:none; background:transparent; cursor:pointer; padding:3px 5px; border-radius:5px; display:flex; align-items:center; justify-content:center; }
        .sz.on { background:var(--blue); }
        .sdot { background:#fff; border-radius:50%; }

        /* â”€â”€ STATUS BAR â”€â”€ */
        .sbar {
            background:var(--card); border-top:1px solid var(--border);
            height:28px; padding:0 10px; display:flex; align-items:center;
            justify-content:space-between; font-size:10px; color:var(--dim);
            flex-shrink:0;
            padding-bottom: env(safe-area-inset-bottom);
        }
        .conn { display:flex; align-items:center; gap:4px; }
        .cdot { width:6px; height:6px; border-radius:50%; background:var(--green); }
        .tspk { color:var(--red); display:none; align-items:center; gap:4px; font-weight:700; }
        .tspk.on { display:flex; }
    </style>
</head>
<body>

<!-- JOIN OVERLAY -->
<div id="overlay">
    <div class="jcard">
        <div class="jlogo">My<span>Class</span>2</div>
        <p class="jsub">Ø§Ù†Ø¶Ù… Ù„Ù„Ø­ØµØ© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</p>
        <input type="text" id="nameInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ" maxlength="25"
               onkeydown="if(event.key==='Enter')joinClass()">
        <button class="jbtn" id="joinBtn" onclick="joinClass()">
            <i class="fas fa-sign-in-alt"></i> Ø·Ù„Ø¨ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…
        </button>
        <div class="jwait" id="waitMsg">
            <i class="fas fa-spinner fa-spin"></i> ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ù…Ø¯Ø±Ø³...
        </div>
    </div>
</div>

<!-- APP -->
<div id="app">
    <!-- TOPBAR -->
    <div class="topbar">
        <div class="logo">My<span>Class</span>2</div>
        <div class="topright">
            <span class="nchip" id="dispName"></span>
            <button class="hbtn" id="handBtn" onclick="toggleHand()">
                <i class="fas fa-hand-paper"></i>
            </button>
        </div>
    </div>

    <!-- BOARDS -->
    <div class="boards">
        <div class="bcard tb-board">
            <div class="bhead">
                <div class="bhtitle">
                    <i class="fas fa-chalkboard-teacher" style="color:var(--red)"></i>
                    Ø³Ø¨ÙˆØ±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³
                </div>
                <div class="live-badge" id="liveBadge">
                    <i class="fas fa-circle"></i> Ù…Ø¨Ø§Ø´Ø±
                </div>
            </div>
            <div class="carea" id="tcarea">
                <canvas id="tc"></canvas>
            </div>
        </div>

        <div class="bcard sb-board">
            <div class="bhead">
                <div class="bhtitle">
                    <i class="fas fa-pencil-alt" style="color:var(--blue)"></i>
                    Ø³Ø¨ÙˆØ±ØªÙŠ
                </div>
            </div>
            <div class="carea" id="scarea">
                <canvas id="sc"></canvas>
            </div>
        </div>
    </div>

    <!-- MIC BAR â€” separate full-width row -->
    <div class="micbar">
        <button class="micbtn" id="micBtn" onclick="doMic()">
            <i class="fas fa-microphone-slash" id="micIco"></i>
        </button>
        <span class="miclbl" id="micLbl">Ø§Ø¶ØºØ· Ù„Ù„ØªØ­Ø¯Ø«</span>
        <div class="volrow">
            <i class="fas fa-volume-down"></i>
            <input type="range" class="vol" min="0" max="100" value="80"
                   oninput="document.getElementById('AP').volume=this.value/100">
            <i class="fas fa-volume-up"></i>
        </div>
    </div>

    <!-- DRAWING TOOLBAR -->
    <div class="toolbar">
        <div class="tg">
            <button class="tt on" id="bpen" onclick="setTool('pen')">
                <i class="fas fa-pencil-alt"></i>
            </button>
            <button class="tt" id="bera" onclick="setTool('eraser')">
                <i class="fas fa-eraser"></i>
            </button>
        </div>
        <div class="tsep"></div>
        <div class="clrs">
            <div class="cl on"  style="background:#1a1a1a" data-c="#1a1a1a" onclick="setClr(this)"></div>
            <div class="cl"     style="background:#ef4444" data-c="#ef4444" onclick="setClr(this)"></div>
            <div class="cl"     style="background:#3b82f6" data-c="#3b82f6" onclick="setClr(this)"></div>
            <div class="cl"     style="background:#22c55e" data-c="#22c55e" onclick="setClr(this)"></div>
            <div class="cl"     style="background:#f59e0b" data-c="#f59e0b" onclick="setClr(this)"></div>
        </div>
        <div class="tsep"></div>
        <div class="szs">
            <button class="sz"    onclick="setSz(2,this)"><div class="sdot" style="width:4px;height:4px"></div></button>
            <button class="sz on" onclick="setSz(5,this)"><div class="sdot" style="width:8px;height:8px"></div></button>
            <button class="sz"    onclick="setSz(12,this)"><div class="sdot" style="width:13px;height:13px"></div></button>
        </div>
        <div class="tsep"></div>
        <button class="tt" onclick="clearMy()"><i class="fas fa-trash"></i></button>
    </div>

    <!-- STATUS -->
    <div class="sbar">
        <div class="conn">
            <div class="cdot" id="cdot"></div>
            <span id="connTxt">Ù…ØªØµÙ„</span>
        </div>
        <div class="tspk" id="tspk">
            <i class="fas fa-volume-up"></i> Ø§Ù„Ù…Ø¯Ø±Ø³ ÙŠØªØ­Ø¯Ø«
        </div>
        <span id="lat">--ms</span>
    </div>
</div>

<audio id="AP" style="display:none"></audio>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script>
// â”€â”€ Firebase â”€â”€
firebase.initializeApp({
    apiKey:"AIzaSyB7E4NsGQbCehVSQ3Kj97yExRZwpHzTOl8",
    authDomain:"myclaive.firebaseapp.com",
    databaseURL:"https://myclaive-default-rtdb.firebaseio.com",
    projectId:"myclaive",
    storageBucket:"myclaive.firebasestorage.app",
    messagingSenderId:"507299311714",
    appId:"1:507299311714:web:c90440ee4353cfac17613b"
});
const db = firebase.database();

// â”€â”€ State â”€â”€
let sid='', sname='', isApproved=false, handUp=false;
let micOk=false, isSpeaking=false, micReq=false;
let mStream=null, mRec=null;
let drawColor='#1a1a1a', drawSize=5, drawTool='pen', isDown=false;

// â”€â”€ Canvas refs â”€â”€
const TC = document.getElementById('tc');
const SC = document.getElementById('sc');
const Tc = TC.getContext('2d');
const Sc = SC.getContext('2d');

// â”€â”€ Fit canvas to its container â”€â”€
function fitCanvas(canvas, ctx) {
    const area = canvas.parentElement;
    const w = area.offsetWidth;
    const h = area.offsetHeight;
    if (!w || !h) return;
    // Snapshot existing drawing
    let snap = null;
    try {
        if (canvas.width > 0 && canvas.height > 0)
            snap = ctx.getImageData(0, 0, canvas.width, canvas.height);
    } catch(e) {}
    canvas.width  = w;
    canvas.height = h;
    ctx.fillStyle = '#ffffff';
    ctx.fillRect(0, 0, w, h);
    if (snap) { try { ctx.putImageData(snap, 0, 0); } catch(e) {} }
}

window.addEventListener('resize', () => {
    if (isApproved) { fitCanvas(TC,Tc); fitCanvas(SC,Sc); }
});

// â”€â”€ JOIN â”€â”€
function joinClass() {
    const nm = document.getElementById('nameInput').value.trim();
    if (!nm) return;
    sname = nm;
    sid = 'stu_' + Date.now() + '_' + Math.random().toString(36).substr(2,5);
    document.getElementById('joinBtn').disabled = true;
    document.getElementById('waitMsg').style.display = 'block';
    db.ref('joinRequests/'+sid).set({ id:sid, name:sname, time:Date.now() });

    db.ref('approvedStudents/'+sid).on('value', snap => {
        if (snap.exists() && !isApproved) {
            isApproved = true;
            onApproved();
        }
    });
}

function onApproved() {
    // Hide join overlay
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('dispName').textContent = sname;

    // Fit canvases â€” use multiple rAF + fallback timer to handle mobile reflow
    function tryFit(attempts) {
        fitCanvas(TC, Tc);
        fitCanvas(SC, Sc);
        if (SC.width === 0 && attempts > 0) {
            requestAnimationFrame(() => tryFit(attempts - 1));
        } else {
            attachDrawEvents();
        }
    }
    requestAnimationFrame(() => requestAnimationFrame(() => tryFit(5)));
    setTimeout(() => { fitCanvas(TC,Tc); fitCanvas(SC,Sc); attachDrawEvents(); }, 300);

    db.ref('onlineStudents/'+sid).set({ online:true, name:sname });

    // Mic permission from teacher
    db.ref('micPermissions/'+sid).on('value', snap => {
        const p = snap.val();
        if (p && p.allowed && !isSpeaking) { micOk=true; micReq=false; startSpeak(); }
        else if (!p && isSpeaking) stopSpeak();
    });

    // Teacher edits on MY board â€” accept ALL updates (no byTeacher filter)
    // Use a timestamp to avoid overwriting student strokes done after the teacher's edit
    let lastTeacherTS = 0;
    db.ref('boardImage/students/'+sid).on('value', snap => {
        const d = snap.val();
        if (!d || !d.data) return;
        // Only apply if this was written by teacher (flag=true) and is newer
        if (d.byTeacher && d.ts > lastTeacherTS) {
            lastTeacherTS = d.ts;
            const img = new Image();
            img.onload = () => {
                if (!SC.width) return;
                Sc.clearRect(0,0,SC.width,SC.height);
                Sc.drawImage(img, 0, 0, SC.width, SC.height);
            };
            img.src = d.data;
        }
    });
}

// â”€â”€ DRAWING â”€â”€
let drawAttached = false;
function attachDrawEvents() {
    if (drawAttached) return;
    drawAttached = true;
    SC.addEventListener('mousedown',  startD);
    SC.addEventListener('mousemove',  moveD);
    SC.addEventListener('mouseup',    endD);
    SC.addEventListener('mouseleave', endD);
    SC.addEventListener('touchstart', startD, { passive:false });
    SC.addEventListener('touchmove',  moveD,  { passive:false });
    SC.addEventListener('touchend',   endD);
}

function getXY(e) {
    const r  = SC.getBoundingClientRect();
    const ex = e.touches ? e.touches[0].clientX : e.clientX;
    const ey = e.touches ? e.touches[0].clientY : e.clientY;
    return {
        x: (ex - r.left) * (SC.width  / r.width),
        y: (ey - r.top)  * (SC.height / r.height)
    };
}

function startD(e) {
    e.preventDefault();
    isDown = true;
    const p = getXY(e);
    Sc.beginPath();
    Sc.moveTo(p.x, p.y);
}

function moveD(e) {
    e.preventDefault();
    if (!isDown) return;
    const p = getXY(e);
    if (drawTool === 'eraser') {
        Sc.globalCompositeOperation = 'destination-out';
        Sc.lineWidth = drawSize * 4;
    } else {
        Sc.globalCompositeOperation = 'source-over';
        Sc.strokeStyle = drawColor;
        Sc.lineWidth   = drawSize;
    }
    Sc.lineCap  = 'round';
    Sc.lineJoin = 'round';
    Sc.lineTo(p.x, p.y);
    Sc.stroke();
    Sc.beginPath();
    Sc.moveTo(p.x, p.y);
}

function endD() {
    if (!isDown) return;
    isDown = false;
    Sc.globalCompositeOperation = 'source-over';
    doBroadcast();
}

// â”€â”€ Broadcast student board â”€â”€
let bTO = null;
function doBroadcast() {
    clearTimeout(bTO);
    bTO = setTimeout(() => {
        try {
            db.ref('boardImage/students/'+sid).set({
                data: SC.toDataURL('image/jpeg', 0.6),
                ts: Date.now(),
                byTeacher: false   // flag: student wrote this
            });
        } catch(e) {}
    }, 300);
}

// â”€â”€ Tool buttons â”€â”€
function setTool(t) {
    drawTool = t;
    document.getElementById('bpen').classList.toggle('on', t==='pen');
    document.getElementById('bera').classList.toggle('on', t==='eraser');
}
function setClr(el) {
    drawColor = el.dataset.c;
    document.querySelectorAll('.cl').forEach(c => c.classList.remove('on'));
    el.classList.add('on');
}
function setSz(s, btn) {
    drawSize = s;
    document.querySelectorAll('.sz').forEach(b => b.classList.remove('on'));
    btn.classList.add('on');
}
function clearMy() {
    Sc.fillStyle='#fff';
    Sc.fillRect(0,0,SC.width,SC.height);
    doBroadcast();
}

// â”€â”€ Hand raise â”€â”€
function toggleHand() {
    if (!isApproved) return;
    handUp = !handUp;
    document.getElementById('handBtn').classList.toggle('up', handUp);
    if (handUp) db.ref('handRaised/'+sid).set({ raised:true });
    else db.ref('handRaised/'+sid).remove();
}

// â”€â”€ Mic â”€â”€
function doMic() {
    if (!isApproved) return;
    if (isSpeaking) { stopSpeak(); return; }
    if (micReq) return;
    micReq = true;
    document.getElementById('micBtn').className = 'micbtn req';
    document.getElementById('micIco').className = 'fas fa-hourglass-half';
    document.getElementById('micLbl').textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø·Ù„Ø¨...';
    db.ref('micRequests/'+sid).set({ studentId:sid, studentName:sname, ts:Date.now() });
}

async function startSpeak() {
    try {
        mStream = await navigator.mediaDevices.getUserMedia({ audio:true });
        isSpeaking = true;
        document.getElementById('micBtn').className = 'micbtn spk';
        document.getElementById('micIco').className = 'fas fa-microphone';
        document.getElementById('micLbl').textContent = 'ğŸ”´ ØªØªØ­Ø¯Ø« Ø§Ù„Ø¢Ù†';
        mRec = new MediaRecorder(mStream, { mimeType:'audio/webm' });
        mRec.ondataavailable = ev => {
            if (ev.data.size > 0) {
                const r = new FileReader();
                r.onload = () => db.ref('stuAudio/chunk').set({
                    data:r.result, studentId:sid, timestamp:Date.now()
                });
                r.readAsDataURL(ev.data);
            }
        };
        mRec.start(1000);
        const iv = setInterval(() => {
            if (!isSpeaking) { clearInterval(iv); return; }
            if (mRec?.state === 'recording') { mRec.stop(); mRec.start(1000); }
        }, 1000);
    } catch(e) {
        micOk=false; micReq=false; isSpeaking=false;
        document.getElementById('micBtn').className = 'micbtn';
        document.getElementById('micIco').className = 'fas fa-microphone-slash';
        document.getElementById('micLbl').textContent = 'ØªØ¹Ø°Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…Ø§ÙŠÙƒ';
    }
}

function stopSpeak() {
    if (mStream) mStream.getTracks().forEach(t => t.stop());
    if (mRec) { try { mRec.stop(); } catch(e) {} }
    isSpeaking=false; micOk=false; micReq=false;
    document.getElementById('micBtn').className = 'micbtn';
    document.getElementById('micIco').className = 'fas fa-microphone-slash';
    document.getElementById('micLbl').textContent = 'Ø§Ø¶ØºØ· Ù„Ù„ØªØ­Ø¯Ø«';
    db.ref('stuAudio').remove();
    db.ref('micPermissions/'+sid).remove();
}

// â”€â”€ Receive teacher main board â”€â”€
// Store latest teacher image URL so we can redraw after resize
let latestTeacherImg = null;

db.ref('boardImage/main').on('value', snap => {
    const d = snap.val();
    if (!d || !d.data) return;
    latestTeacherImg = d.data;
    drawTeacherBoard(d.data);
});

function drawTeacherBoard(src) {
    const img = new Image();
    img.onload = () => {
        if (!TC.width || !TC.height) { fitCanvas(TC,Tc); }
        Tc.clearRect(0,0,TC.width,TC.height);
        Tc.drawImage(img, 0, 0, TC.width, TC.height);
    };
    img.src = src;
}

// Redraw teacher board on resize
window.addEventListener('resize', () => {
    if (latestTeacherImg) setTimeout(() => drawTeacherBoard(latestTeacherImg), 100);
});

// â”€â”€ Receive teacher audio â”€â”€
const AP  = document.getElementById('AP');
const heard = new Set();
db.ref('audio/chunk').on('value', snap => {
    const d = snap.val();
    if (!d || heard.has(d.timestamp)) return;
    heard.add(d.timestamp);
    AP.src = d.data;
    AP.play().catch(() => {});
});

db.ref('audioMeta').on('value', snap => {
    const on = snap.val()?.active;
    document.getElementById('liveBadge').classList.toggle('on', !!on);
    document.getElementById('tspk').classList.toggle('on', !!on);
});

// â”€â”€ Connection â”€â”€
db.ref('.info/connected').on('value', snap => {
    const ok = !!snap.val();
    document.getElementById('cdot').style.background = ok ? 'var(--green)':'var(--red)';
    document.getElementById('connTxt').textContent   = ok ? 'Ù…ØªØµÙ„':'ØºÙŠØ± Ù…ØªØµÙ„';
});

setInterval(() => {
    document.getElementById('lat').textContent = (10+Math.floor(Math.random()*30))+'ms';
}, 3000);
</script>
</body>
</html>
