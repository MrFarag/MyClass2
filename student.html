<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>MyClass2 - Ø§Ù„Ø·Ø§Ù„Ø¨</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{width:100%;height:100%;overflow:hidden;touch-action:none}
body{font-family:'Segoe UI',sans-serif;background:#111b27;color:#fff;display:flex;flex-direction:column}
.hdr{height:50px;min-height:50px;background:#1e2d3d;padding:0 12px;display:flex;justify-content:space-between;align-items:center;border-bottom:2px solid #3498db;flex-shrink:0}
.logo{font-size:15px;font-weight:bold;display:flex;align-items:center;gap:6px}.logo i{color:#3498db}
.pb{background:#27ae60;padding:4px 10px;border-radius:20px;font-size:12px;display:flex;align-items:center;gap:5px;transition:background .3s}
.boards{flex:1;display:flex;flex-direction:column;padding:6px;gap:6px;overflow:hidden;min-height:0}
.board{flex:1;display:flex;flex-direction:column;background:#1e2d3d;border-radius:10px;overflow:hidden;border:1px solid #2c4159;min-height:0}
.bh{padding:7px 12px;background:#243447;display:flex;justify-content:space-between;align-items:center;flex-shrink:0}
.bh.t{border-bottom:3px solid #e67e22}.bh.s{border-bottom:3px solid #27ae60}
.bh span{font-size:12px;font-weight:bold;display:flex;align-items:center;gap:5px}
.abadge{background:#e67e22;padding:2px 8px;border-radius:20px;font-size:10px;display:flex;align-items:center;gap:3px;animation:p1 1s infinite}
@keyframes p1{0%,100%{opacity:1}50%{opacity:.5}}
.cw{flex:1;overflow:auto;background:#eee;-webkit-overflow-scrolling:touch;min-height:0}
canvas{display:block;width:2000px;height:2000px;background:#fff}
#myC{cursor:crosshair;touch-action:none}
#tC{cursor:default;touch-action:pan-x pan-y}
.tb{height:60px;min-height:60px;background:#1e2d3d;border-top:2px solid #3498db;display:flex;align-items:center;justify-content:center;gap:7px;padding:0 10px;flex-shrink:0;overflow-x:auto;flex-wrap:nowrap}
.tb::-webkit-scrollbar{display:none}
.tg{display:flex;gap:4px;background:#111b27;padding:4px 7px;border-radius:20px;align-items:center;flex-shrink:0}
.cb{width:26px;height:26px;border-radius:50%;border:2px solid transparent;cursor:pointer;flex-shrink:0;transition:.15s}
.cb.on{border-color:#fff;box-shadow:0 0 6px rgba(255,255,255,.5);transform:scale(1.15)}
.btn{width:34px;height:34px;border:none;border-radius:50%;background:#2c4159;color:#fff;font-size:13px;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:.15s}
.btn.on,.btn:hover{background:#3498db}
.btn.del{color:#e74c3c}.btn.del:hover{background:#e74c3c;color:#fff}
.btn.mic-on{background:#e74c3c!important;animation:mp 1.5s infinite}
@keyframes mp{0%,100%{box-shadow:0 0 0 0 rgba(231,76,60,.5)}50%{box-shadow:0 0 0 8px transparent}}
.sbar{height:38px;min-height:38px;background:#0e1820;border-top:1px solid #1e2d3d;display:flex;align-items:center;justify-content:space-between;padding:0 12px;font-size:12px;color:#aab8c8;flex-shrink:0}
.dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.dot.on{background:#27ae60;box-shadow:0 0 6px #27ae60}
.dot.c{background:#f39c12;animation:blink .8s infinite}
.dot.aud{background:#e67e22;animation:blink 1s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
.waves{display:flex;gap:2px;align-items:center}
.waves span{display:block;width:3px;background:#e67e22;border-radius:2px;animation:wv .8s infinite}
.waves span:nth-child(1){height:6px}.waves span:nth-child(2){height:12px;animation-delay:.15s}.waves span:nth-child(3){height:6px;animation-delay:.3s}
@keyframes wv{0%,100%{transform:scaleY(.5)}50%{transform:scaleY(1.2)}}
</style>
</head>
<body>

<div class="hdr">
  <div class="logo"><i class="fas fa-user-graduate"></i>MyClass2</div>
  <div class="pb" id="pb"><i class="fas fa-lock-open"></i> ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ÙƒØªØ§Ø¨Ø©</div>
</div>

<div class="boards">
  <div class="board">
    <div class="bh t">
      <span><i class="fas fa-chalkboard-teacher" style="color:#e67e22"></i>Ø³Ø¨ÙˆØ±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³</span>
      <span id="abadge" style="display:none" class="abadge"><i class="fas fa-volume-up"></i>ØµÙˆØª Ù…Ø¨Ø§Ø´Ø±</span>
    </div>
    <div class="cw" id="tw"><canvas id="tC"></canvas></div>
  </div>
  <div class="board">
    <div class="bh s">
      <span><i class="fas fa-pencil-alt" style="color:#27ae60"></i>Ø³Ø¨ÙˆØ±ØªÙŠ</span>
    </div>
    <div class="cw" id="mw"><canvas id="myC"></canvas></div>
  </div>
</div>

<div class="tb">
  <div class="tg">
    <div class="cb on" style="background:#111" onclick="setClr('black',this)"></div>
    <div class="cb" style="background:#e74c3c" onclick="setClr('#e74c3c',this)"></div>
    <div class="cb" style="background:#3498db" onclick="setClr('#3498db',this)"></div>
    <div class="cb" style="background:#27ae60" onclick="setClr('#27ae60',this)"></div>
    <div class="cb" style="background:#f39c12" onclick="setClr('#f39c12',this)"></div>
    <div class="cb" style="background:#fff;border:2px solid #888" onclick="setClr('#fff',this)"></div>
  </div>
  <div class="tg">
    <button class="btn" onclick="setSz(2,this)"><i class="fas fa-pen" style="font-size:10px"></i></button>
    <button class="btn on" onclick="setSz(5,this)"><i class="fas fa-pen-fancy"></i></button>
    <button class="btn" onclick="setSz(12,this)"><i class="fas fa-paint-brush"></i></button>
  </div>
  <div class="tg">
    <button class="btn on" id="penBtn" onclick="setTool('pen')"><i class="fas fa-pencil-alt"></i></button>
    <button class="btn" id="eraserBtn" onclick="setTool('eraser')"><i class="fas fa-eraser"></i></button>
    <button class="btn del" onclick="clearMe()"><i class="fas fa-trash-alt"></i></button>
  </div>
  <div class="tg">
    <button class="btn" id="myMic" onclick="toggleMyMic()">
      <i class="fas fa-microphone-slash" id="myMicIcon"></i>
    </button>
  </div>
</div>

<div class="sbar">
  <div style="display:flex;align-items:center;gap:6px">
    <span class="dot c" id="dotEl"></span>
    <span id="stEl">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</span>
  </div>
  <div style="display:flex;align-items:center;gap:6px">
    <span id="spkEl"><i class="fas fa-volume-mute" style="color:#e74c3c"></i></span>
    <div class="waves" id="wvEl" style="display:none"><span></span><span></span><span></span></div>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script>
firebase.initializeApp({
  apiKey:"AIzaSyB7E4NsGQbCehVSQ3Kj97yExRZwpHzTOl8",
  authDomain:"myclaive.firebaseapp.com",
  databaseURL:"https://myclaive-default-rtdb.firebaseio.com",
  projectId:"myclaive",
  storageBucket:"myclaive.firebasestorage.app",
  messagingSenderId:"507299311714",
  appId:"1:507299311714:web:c90440ee4353cfac17613b"
});
const db=firebase.database();

// â”€â”€ Canvas â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const tC=document.getElementById('tC'), myC=document.getElementById('myC');
const tx=tC.getContext('2d'),           mc=myC.getContext('2d');
const twEl=document.getElementById('tw'), mwEl=document.getElementById('mw');
tC.width=2000;  tC.height=2000;
myC.width=2000; myC.height=2000;
[tx,mc].forEach(c=>{c.lineCap='round';c.lineJoin='round'});

// â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let tool='pen', clr='black', sz=5;
let drawing=false, lx=0, ly=0;
let canDraw=true;
const sid='s_'+Date.now()+'_'+Math.random().toString(36).substr(2,5);
let strokeId=0, myMicOn=false, myMicStream=null, myRecInterval=null, mySlot=0;

// â”€â”€ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø±Ø³Ù… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getPos(e, canvas, wrapper){
  const r=wrapper.getBoundingClientRect();
  const cx=e.touches?e.touches[0].clientX:e.clientX;
  const cy=e.touches?e.touches[0].clientY:e.clientY;
  return{
    x:(cx-r.left+wrapper.scrollLeft)*(2000/wrapper.clientWidth),
    y:(cy-r.top +wrapper.scrollTop )*(2000/wrapper.clientHeight)
  };
}

// â”€â”€ Ø±Ø³Ù… Ù…Ø­Ù„ÙŠ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function drawSeg(x1,y1,x2,y2){
  mc.save();
  if(tool==='eraser'){mc.globalCompositeOperation='destination-out';mc.strokeStyle='rgba(0,0,0,1)';mc.lineWidth=30;}
  else{mc.globalCompositeOperation='source-over';mc.strokeStyle=clr;mc.lineWidth=sz;}
  mc.lineCap='round';mc.lineJoin='round';
  mc.beginPath();mc.moveTo(x1,y1);
  mc.quadraticCurveTo(x1,y1,(x1+x2)/2,(y1+y2)/2);
  mc.stroke();mc.restore();
}

// â”€â”€ Ø¥Ø±Ø³Ø§Ù„ Ù„Ù€ Firebase: ÙƒÙ„ 30ms batch â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let batch=[], bTimer=null;

function flushBatch(){
  if(!batch.length)return;
  db.ref('studentDraw').push({
    id:  strokeId,
    pts: batch.splice(0),
    c:   tool==='eraser'?null:clr,
    s:   tool==='eraser'?30:sz,
    e:   tool==='eraser'?1:0,
    sid, ts:Date.now()
  });
}

function startDraw(e){
  e.preventDefault();
  if(!canDraw){shake();return;}
  drawing=true; strokeId++;
  const p=getPos(e,myC,mwEl); lx=p.x; ly=p.y;
  batch=[{x:p.x,y:p.y}];
  // Ù†Ù‚Ø·Ø© Ù…Ø±Ø¦ÙŠØ© Ø£ÙˆÙ„Ù‰
  mc.save();
  mc.globalCompositeOperation=tool==='eraser'?'destination-out':'source-over';
  mc.fillStyle=tool==='eraser'?'rgba(0,0,0,1)':clr;
  mc.beginPath();mc.arc(p.x,p.y,sz/2,0,Math.PI*2);mc.fill();mc.restore();
}

function moveDraw(e){
  e.preventDefault();if(!drawing||!canDraw)return;
  const p=getPos(e,myC,mwEl);
  drawSeg(lx,ly,p.x,p.y);
  batch.push({x:p.x,y:p.y});
  if(!bTimer) bTimer=setTimeout(()=>{flushBatch();bTimer=null;},30);
  lx=p.x;ly=p.y;
}

function stopDraw(){
  if(!drawing)return;drawing=false;
  if(bTimer){clearTimeout(bTimer);bTimer=null;}
  flushBatch();
  mc.globalCompositeOperation='source-over';
}

myC.addEventListener('mousedown', startDraw);
myC.addEventListener('mousemove', moveDraw);
myC.addEventListener('mouseup',   stopDraw);
myC.addEventListener('mouseleave',stopDraw);
myC.addEventListener('touchstart',startDraw,{passive:false});
myC.addEventListener('touchmove', moveDraw, {passive:false});
myC.addEventListener('touchend',  stopDraw);
myC.addEventListener('touchcancel',stopDraw);

// â”€â”€ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø±Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³: Ù†ØªØªØ¨Ø¹ Ø¢Ø®Ø± Ù†Ù‚Ø·Ø© Ù„ÙƒÙ„ strokeId â”€â”€â”€â”€â”€â”€â”€â”€â”€
const strokes={};  // "ref_id" â†’ {lastX, lastY}

function renderBatch(ctx, d){
  if(!d||!d.pts||!d.pts.length)return;
  const key = d.id;
  if(!strokes[key]){
    strokes[key]={lastX:d.pts[0].x, lastY:d.pts[0].y};
    // Ù†Ù‚Ø·Ø© Ø£ÙˆÙ„Ù‰ Ù…Ø±Ø¦ÙŠØ©
    ctx.save();
    ctx.globalCompositeOperation=d.e?'destination-out':'source-over';
    ctx.fillStyle=d.e?'rgba(0,0,0,1)':(d.c||'#000');
    ctx.beginPath();ctx.arc(d.pts[0].x,d.pts[0].y,(d.s||3)/2,0,Math.PI*2);ctx.fill();
    ctx.restore();
  }
  const st=strokes[key];
  ctx.save();
  if(d.e){ctx.globalCompositeOperation='destination-out';ctx.strokeStyle='rgba(0,0,0,1)';ctx.lineWidth=30;}
  else{ctx.globalCompositeOperation='source-over';ctx.strokeStyle=d.c||'#000';ctx.lineWidth=d.s||3;}
  ctx.lineCap='round';ctx.lineJoin='round';
  ctx.beginPath();ctx.moveTo(st.lastX,st.lastY);
  for(const p of d.pts){
    const mx=(st.lastX+p.x)/2, my=(st.lastY+p.y)/2;
    ctx.quadraticCurveTo(st.lastX,st.lastY,mx,my);
    st.lastX=p.x;st.lastY=p.y;
  }
  ctx.stroke();ctx.restore();
}

db.ref('tDraw').on('child_added', snap=>renderBatch(tx, snap.val()));
db.ref('sDraw').on('child_added', snap=>renderBatch(mc, snap.val()));

db.ref('cmd').on('child_added',snap=>{
  const d=snap.val();
  if(d&&d.type==='clear'){tx.clearRect(0,0,2000,2000);mc.clearRect(0,0,2000,2000);}
});

db.ref('ctrl').on('value',snap=>{
  const v=snap.val();if(!v)return;
  canDraw=v.studentsCanDraw!==false;
  const pb=document.getElementById('pb');
  pb.innerHTML=canDraw?'<i class="fas fa-lock-open"></i> ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ÙƒØªØ§Ø¨Ø©':'<i class="fas fa-lock"></i> Ø§Ù„ÙƒØªØ§Ø¨Ø© Ù…Ù…Ù†ÙˆØ¹Ø©';
  pb.style.background=canDraw?'#27ae60':'#e74c3c';
});

// â”€â”€ AUDIO: ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ù…Ø¯Ø±Ø³ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Ø§Ù„Ù…Ø¯Ø±Ø³ ÙŠÙƒØªØ¨ ÙÙŠ audio/slot0 Ùˆ audio/slot1 Ø¨Ø§Ù„ØªÙ†Ø§ÙˆØ¨
// Ù†Ø³ØªÙ…Ø¹ Ø¨Ù€ on('value') Ø¹Ù„Ù‰ ÙƒÙ„ slot â†’ ÙŠØ·Ù„Ù‚ ÙƒÙ„Ù…Ø§ ØªØºÙŠØ±Øª Ø§Ù„Ù‚ÙŠÙ…Ø©

const heardTs=new Set();
let audioQueue=[];
let audioPlaying=false;
const audioEl=document.createElement('audio');
audioEl.autoplay=true;
audioEl.playsinline=true;
document.body.appendChild(audioEl);

function playQueue(){
  if(audioPlaying||!audioQueue.length)return;
  audioPlaying=true;
  const src=audioQueue.shift();
  audioEl.src=src;
  audioEl.onended=()=>{audioPlaying=false;playQueue();};
  audioEl.onerror=()=>{audioPlaying=false;playQueue();};
  audioEl.play().catch(()=>{audioPlaying=false;});
}

function handleSlot(d){
  if(!d||!d.d||!d.ts||heardTs.has(d.ts))return;
  heardTs.add(d.ts);
  audioQueue.push(d.d);
  playQueue();
}

// Ø§Ø³ØªÙ…Ø¹ Ù„Ù€ slot0 Ùˆ slot1 Ø¨Ù€ on('value') â€” ÙŠØ·Ù„Ù‚ Ø¹Ù†Ø¯ ÙƒÙ„ ØªØºÙŠÙŠØ±
db.ref('audio/slot0').on('value', snap=>handleSlot(snap.val()));
db.ref('audio/slot1').on('value', snap=>handleSlot(snap.val()));

db.ref('audioMeta').on('value',snap=>{
  const v=snap.val(), active=v&&v.active;
  document.getElementById('abadge').style.display=active?'flex':'none';
  document.getElementById('spkEl').innerHTML=active
    ?'<i class="fas fa-volume-up" style="color:#e67e22"></i>'
    :'<i class="fas fa-volume-mute" style="color:#e74c3c"></i>';
  document.getElementById('wvEl').style.display=active?'flex':'none';
  document.getElementById('dotEl').className='dot '+(active?'aud':'on');
  document.getElementById('stEl').textContent=active?'ðŸŽ¤ Ø§Ù„Ù…Ø¯Ø±Ø³ ÙŠØªÙƒÙ„Ù…':'Ù…ØªØµÙ„';
  if(!active){audioQueue=[];audioPlaying=false;heardTs.clear();}
});

// â”€â”€ Ù…Ø§ÙŠÙƒ Ø§Ù„Ø·Ø§Ù„Ø¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getMime(){
  for(const t of['audio/webm;codecs=opus','audio/webm','audio/ogg;codecs=opus'])
    if(MediaRecorder.isTypeSupported(t))return t;
  return '';
}
function toB64(blob){return new Promise(r=>{const f=new FileReader();f.onloadend=()=>r(f.result);f.readAsDataURL(blob);})}

function myRecordOnce(){
  if(!myMicStream||!myMicOn)return;
  const mime=getMime();
  const rec=new MediaRecorder(myMicStream,mime?{mimeType:mime}:{});
  const chunks=[];
  rec.ondataavailable=ev=>{if(ev.data&&ev.data.size>0)chunks.push(ev.data);};
  rec.onstop=async()=>{
    if(!myMicOn||!chunks.length)return;
    const b64=await toB64(new Blob(chunks,{type:mime||'audio/webm'}));
    mySlot=mySlot===0?1:0;
    db.ref('studentAudio/slot'+mySlot).set({d:b64,ts:Date.now()});
  };
  rec.start();
  setTimeout(()=>{try{rec.stop();}catch(e){}},2800);
}

async function toggleMyMic(){
  const btn=document.getElementById('myMic');
  const icon=document.getElementById('myMicIcon');
  if(!myMicOn){
    icon.className='fas fa-spinner fa-spin';
    try{
      myMicStream=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:true,noiseSuppression:true,autoGainControl:true}});
      myMicOn=true;
      btn.classList.add('mic-on');
      icon.className='fas fa-microphone';
      myRecordOnce();
      myRecInterval=setInterval(myRecordOnce,3000);
    }catch(err){
      icon.className='fas fa-microphone-slash';
      alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…Ø§ÙŠÙƒØ±ÙˆÙÙˆÙ†:\n'+err.message);
    }
  }else{
    clearInterval(myRecInterval);myRecInterval=null;
    if(myMicStream)myMicStream.getTracks().forEach(t=>t.stop());
    myMicStream=null;myMicOn=false;
    db.ref('studentAudio').remove();
    btn.classList.remove('mic-on');
    icon.className='fas fa-microphone-slash';
  }
}

// â”€â”€ Ø£Ø¯ÙˆØ§Øª â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setClr(c,el){if(!canDraw)return;clr=c;tool='pen';document.querySelectorAll('.cb').forEach(b=>b.classList.remove('on'));el.classList.add('on');setTool('pen');}
function setSz(s,el){sz=s;document.querySelectorAll('.tg:nth-child(2) .btn').forEach(b=>b.classList.remove('on'));el.classList.add('on');}
function setTool(t){tool=t;document.getElementById('penBtn').classList.toggle('on',t==='pen');document.getElementById('eraserBtn').classList.toggle('on',t==='eraser');}
function clearMe(){if(!canDraw)return;mc.clearRect(0,0,2000,2000);}
function shake(){const pb=document.getElementById('pb');[0,-5,5,-5,0].forEach((v,i)=>setTimeout(()=>pb.style.transform=`translateX(${v}px)`,i*50));}

// â”€â”€ ÙØªØ­ AudioContext Ø¹Ù†Ø¯ Ø£ÙˆÙ„ ØªÙØ§Ø¹Ù„ (iOS) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function unlockAudio(){
  audioEl.play().catch(()=>{});
}
document.body.addEventListener('touchstart',unlockAudio,{once:true});
document.body.addEventListener('click',unlockAudio,{once:true});

// â”€â”€ Ø§ØªØµØ§Ù„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
db.ref('.info/connected').on('value',snap=>{
  document.getElementById('dotEl').className='dot '+(snap.val()?'on':'c');
  document.getElementById('stEl').textContent=snap.val()?'Ù…ØªØµÙ„':'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...';
});
db.ref('onlineStudents/'+sid).set({online:true,canDraw:true,ts:Date.now()});
window.addEventListener('beforeunload',()=>{
  db.ref('onlineStudents/'+sid).remove();
  db.ref('studentAudio').remove();
  if(myMicStream)myMicStream.getTracks().forEach(t=>t.stop());
});
[tC,myC].forEach(c=>c.addEventListener('contextmenu',e=>e.preventDefault()));
</script>
</body>
</html>
