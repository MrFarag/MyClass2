<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>MyClass2 - Ø§Ù„Ù…Ø¯Ø±Ø³</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100dvh;overflow:hidden;font-family:'Segoe UI',sans-serif;background:#1a2634;color:#fff;display:flex;flex-direction:column}
.hdr{height:48px;min-height:48px;background:#2c3e50;display:flex;align-items:center;justify-content:space-between;padding:0 14px;border-bottom:3px solid #e67e22;flex-shrink:0;gap:8px}
.logo{font-size:15px;font-weight:bold;white-space:nowrap}.logo i{color:#e67e22;margin-left:6px}
.hdr-r{display:flex;align-items:center;gap:8px}
.badge{padding:4px 12px;border-radius:20px;font-size:12px;display:flex;align-items:center;gap:5px;background:#27ae60}
.mic-ind{display:none;align-items:center;gap:5px;background:#e74c3c;padding:4px 12px;border-radius:20px;font-size:12px;animation:p1 1s infinite}
.mic-ind.on{display:flex}
@keyframes p1{0%,100%{opacity:1}50%{opacity:.5}}
.boards{flex:1;display:flex;padding:6px;gap:6px;overflow:hidden;min-height:0}
@media(max-width:768px){.boards{flex-direction:column}}
.board{flex:1;display:flex;flex-direction:column;background:#2c3e50;border-radius:10px;overflow:hidden;min-height:0}
.bh{padding:8px 12px;background:#34495e;display:flex;align-items:center;justify-content:space-between;flex-shrink:0;border-bottom:2px solid #e67e22}
.bh.b{border-bottom-color:#3498db}
.bh span{font-size:13px;font-weight:bold}
.bh button{background:rgba(255,255,255,.1);border:none;color:#fff;width:30px;height:30px;border-radius:6px;cursor:pointer;font-size:13px;margin-right:4px}
.bh button:hover{background:#e67e22}
.cscroll{flex:1;overflow:auto;background:#ccc;-webkit-overflow-scrolling:touch;min-height:0}
canvas{display:block;width:2000px;height:1500px;background:#fff;touch-action:none;cursor:crosshair}
.tb{background:#34495e;padding:8px;display:flex;flex-wrap:wrap;gap:5px;align-items:center;border-top:2px solid #e67e22;flex-shrink:0}
@media(max-width:768px){.tb{flex-wrap:nowrap;overflow-x:auto;padding:6px 8px}}
.tb::-webkit-scrollbar{height:3px}.tb::-webkit-scrollbar-thumb{background:#e67e22;border-radius:2px}
.tg{display:flex;gap:3px;background:#2c3e50;padding:4px;border-radius:8px}
.cb{width:30px;height:30px;border-radius:50%;border:3px solid transparent;cursor:pointer;transition:.15s;flex-shrink:0}
.cb.on,.cb:hover{border-color:#fff;transform:scale(1.1)}
.btn{width:36px;height:36px;border:none;border-radius:6px;background:#3d566e;color:#fff;font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:.2s}
.btn:hover,.btn.on{background:#e67e22}
.btn.del{background:#c0392b}.btn.del:hover{background:#e74c3c}
.btn.mic-on{background:#e74c3c!important;animation:mp 1.5s infinite}
@keyframes mp{0%,100%{box-shadow:0 0 0 0 rgba(231,76,60,.5)}50%{box-shadow:0 0 0 8px transparent}}
.szd{background:#fff;border-radius:50%}
.students{background:#2c3e50;padding:5px 14px;border-top:1px solid #34495e;max-height:46px;overflow-y:auto;flex-shrink:0}
.slist{display:flex;flex-wrap:wrap;gap:5px}
.chip{background:#34495e;padding:3px 10px;border-radius:20px;font-size:11px;display:flex;align-items:center;gap:5px;border-right:3px solid #27ae60}
.sbar{height:30px;min-height:30px;background:#111b27;border-top:1px solid #243447;display:flex;align-items:center;padding:0 12px;font-size:11px;color:#aab8c8;flex-shrink:0}
.dot{width:8px;height:8px;border-radius:50%;margin-left:6px}
.dot.on{background:#27ae60;box-shadow:0 0 5px #27ae60}.dot.off{background:#e74c3c}
</style>
</head>
<body>
<div class="hdr">
  <div class="logo"><i class="fas fa-chalkboard-teacher"></i>MyClass2 â€” Ø§Ù„Ù…Ø¯Ø±Ø³</div>
  <div class="hdr-r">
    <div class="mic-ind" id="micInd"><i class="fas fa-microphone"></i> Ù…Ø§ÙŠÙƒ Ø´ØºÙ‘Ø§Ù„</div>
    <div class="badge"><i class="fas fa-users"></i><span id="cnt">0</span></div>
  </div>
</div>

<div class="boards">
  <div class="board">
    <div class="bh">
      <span><i class="fas fa-pen-fancy" style="color:#e67e22"></i> Ø³Ø¨ÙˆØ±ØªÙŠ</span>
      <div><button onclick="clearT()"><i class="fas fa-eraser"></i></button></div>
    </div>
    <div class="cscroll" id="ts"><canvas id="tc"></canvas></div>
  </div>
  <div class="board">
    <div class="bh b">
      <span><i class="fas fa-users" style="color:#3498db"></i> Ø³Ø¨ÙˆØ±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</span>
      <div><button onclick="clearS()"><i class="fas fa-eraser"></i></button></div>
    </div>
    <div class="cscroll" id="ss"><canvas id="sc"></canvas></div>
  </div>
</div>

<div class="tb">
  <div class="tg">
    <div class="cb on" style="background:#111" onclick="setClr('#111',this)"></div>
    <div class="cb" style="background:#e74c3c" onclick="setClr('#e74c3c',this)"></div>
    <div class="cb" style="background:#2980b9" onclick="setClr('#2980b9',this)"></div>
    <div class="cb" style="background:#27ae60" onclick="setClr('#27ae60',this)"></div>
    <div class="cb" style="background:#8e44ad" onclick="setClr('#8e44ad',this)"></div>
    <div class="cb" style="background:#e67e22" onclick="setClr('#e67e22',this)"></div>
    <div class="cb" style="background:#fff;border:2px solid #999" onclick="setClr('#fff',this)"></div>
  </div>
  <div class="tg">
    <button class="btn on" id="sz1" onclick="setSz(2,'sz1')"><div class="szd" style="width:4px;height:4px"></div></button>
    <button class="btn" id="sz2" onclick="setSz(5,'sz2')"><div class="szd" style="width:8px;height:8px"></div></button>
    <button class="btn" id="sz3" onclick="setSz(12,'sz3')"><div class="szd" style="width:14px;height:14px"></div></button>
  </div>
  <div class="tg">
    <button class="btn on" id="penBtn" onclick="setTool('pen')"><i class="fas fa-pencil-alt"></i></button>
    <button class="btn" id="eraserBtn" onclick="setTool('eraser')"><i class="fas fa-eraser"></i></button>
    <button class="btn del" onclick="clearAll()"><i class="fas fa-trash-alt"></i></button>
  </div>
  <div class="tg">
    <button class="btn" id="micBtn" onclick="toggleMic()"><i class="fas fa-microphone" id="micIcon"></i></button>
    <button class="btn" id="lockBtn" onclick="toggleLock()" style="background:#27ae60"><i class="fas fa-lock-open" id="lockIcon"></i></button>
  </div>
</div>

<div class="students"><div class="slist" id="slist"></div></div>
<div class="sbar">
  <span class="dot on" id="dotEl"></span><span id="stEl">Ù…ØªØµÙ„</span>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script>
firebase.initializeApp({
  apiKey:"AIzaSyB7E4NsGQbCehVSQ3Kj97yExRZwpHzTOl8",
  authDomain:"myclaive.firebaseapp.com",
  databaseURL:"https://myclaive-default-rtdb.firebaseio.com",
  projectId:"myclaive",
  storageBucket:"myclaive.firebasestorage.app",
  messagingSenderId:"507299311714",
  appId:"1:507299311714:web:c90440ee4353cfac17613b"
});
const db = firebase.database();

// â”€â”€ Canvas â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const tc = document.getElementById('tc'), sc = document.getElementById('sc');
const tx = tc.getContext('2d'),           sx = sc.getContext('2d');
const tsEl = document.getElementById('ts'), ssEl = document.getElementById('ss');
tc.width=2000; tc.height=1500;
sc.width=2000; sc.height=1500;
[tx,sx].forEach(c=>{c.lineCap='round';c.lineJoin='round'});

// â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let tool='pen', clr='#111', sz=2;
let drawing=false, lx=0, ly=0;
let studentsCanDraw=true;
let micOn=false, micStream=null;
let recInterval=null;

// ÙƒÙ„ stroke Ù„Ù‡ strokeId ÙØ±ÙŠØ¯ â€” Ø§Ù„Ø·Ø§Ù„Ø¨ ÙŠØ¬Ù…Ø¹ Ø§Ù„Ù†Ù‚Ø§Ø· ØªØ­Øª Ù†ÙØ³ Ø§Ù„Ù€ id
let strokeId = 0;
let activeCtx=null, activeTarget=null;

// â”€â”€ Ù…ÙˆÙ‚Ø¹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getPos(e, canvas, scroll) {
  const cx = e.touches ? e.touches[0].clientX : e.clientX;
  const cy = e.touches ? e.touches[0].clientY : e.clientY;
  const r  = canvas.getBoundingClientRect();
  return {
    x: (cx - r.left + scroll.scrollLeft) * (2000 / r.width),
    y: (cy - r.top  + scroll.scrollTop)  * (1500 / r.height)
  };
}

// â”€â”€ Ø±Ø³Ù… Ù…Ø­Ù„ÙŠ Ù†Ø§Ø¹Ù… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function drawSegment(ctx, x1, y1, x2, y2) {
  ctx.save();
  if (tool==='eraser') { ctx.globalCompositeOperation='destination-out'; ctx.strokeStyle='rgba(0,0,0,1)'; ctx.lineWidth=30; }
  else                 { ctx.globalCompositeOperation='source-over';     ctx.strokeStyle=clr;              ctx.lineWidth=sz; }
  ctx.lineCap='round'; ctx.lineJoin='round';
  ctx.beginPath(); ctx.moveTo(x1,y1);
  ctx.quadraticCurveTo(x1,y1, (x1+x2)/2, (y1+y2)/2);
  ctx.stroke(); ctx.restore();
}

// â”€â”€ Ø§Ù„Ø±Ø³Ù…: Ù†Ø±Ø³Ù„ ÙƒÙ„ Ù†Ù‚Ø·Ø© ÙÙˆØ± Ø­Ø¯ÙˆØ«Ù‡Ø§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Ù„ÙƒÙ† Ù†Ø¶ØºØ·Ù‡Ø§ ÙÙŠ Ù…ØµÙÙˆÙØ© ÙˆÙ†Ø±Ø³Ù„Ù‡Ø§ ÙƒÙ„ 30ms Ù„ØªÙ‚Ù„ÙŠÙ„ Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
let batch=[], bTimer=null;

function flushBatch() {
  if (!batch.length || !activeTarget) return;
  // Ø£Ø±Ø³Ù„ ÙƒÙ€ segment ÙˆØ§Ø­Ø¯ Ø¨Ù…ØµÙÙˆÙØ© Ù†Ù‚Ø§Ø·
  activeTarget.push({
    id: strokeId,
    pts: batch.splice(0),
    c:  tool==='eraser' ? null : clr,
    s:  tool==='eraser' ? 30   : sz,
    e:  tool==='eraser' ? 1    : 0,
    ts: Date.now()
  });
}

function startD(cvs, scroll, ref, e) {
  e.preventDefault(); drawing=true;
  activeCtx    = cvs===tc ? tx : sx;
  activeTarget = ref;
  strokeId++;
  const p=getPos(e,cvs,scroll); lx=p.x; ly=p.y;
  batch=[{x:p.x,y:p.y}];
  // Ù†Ù‚Ø·Ø© Ù…Ø±Ø¦ÙŠØ© ÙÙˆØ±ÙŠØ©
  activeCtx.save();
  activeCtx.globalCompositeOperation = tool==='eraser'?'destination-out':'source-over';
  activeCtx.fillStyle = tool==='eraser'?'rgba(0,0,0,1)':clr;
  activeCtx.beginPath(); activeCtx.arc(p.x,p.y,sz/2,0,Math.PI*2); activeCtx.fill();
  activeCtx.restore();
}

function moveD(e) {
  e.preventDefault(); if (!drawing) return;
  const cvs    = activeCtx===tx ? tc : sc;
  const scroll = activeCtx===tx ? tsEl : ssEl;
  const p=getPos(e,cvs,scroll);
  drawSegment(activeCtx,lx,ly,p.x,p.y);
  batch.push({x:p.x,y:p.y});
  if (!bTimer) bTimer = setTimeout(()=>{ flushBatch(); bTimer=null; }, 30);
  lx=p.x; ly=p.y;
}

function stopD() {
  if (!drawing) return; drawing=false;
  if (bTimer) { clearTimeout(bTimer); bTimer=null; }
  flushBatch();
  batch=[];
}

tc.addEventListener('mousedown',  e=>startD(tc,tsEl,db.ref('tDraw'),e));
tc.addEventListener('mousemove',  moveD);
tc.addEventListener('mouseup',    stopD);
tc.addEventListener('mouseleave', stopD);
tc.addEventListener('touchstart', e=>startD(tc,tsEl,db.ref('tDraw'),e),{passive:false});
tc.addEventListener('touchmove',  moveD,{passive:false});
tc.addEventListener('touchend',   stopD);

sc.addEventListener('mousedown',  e=>startD(sc,ssEl,db.ref('sDraw'),e));
sc.addEventListener('mousemove',  moveD);
sc.addEventListener('mouseup',    stopD);
sc.addEventListener('mouseleave', stopD);
sc.addEventListener('touchstart', e=>startD(sc,ssEl,db.ref('sDraw'),e),{passive:false});
sc.addEventListener('touchmove',  moveD,{passive:false});
sc.addEventListener('touchend',   stopD);

// â”€â”€ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø±Ø³Ù… Ø§Ù„Ø·Ù„Ø§Ø¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Ù†Ø¬Ù…Ø¹ Ø§Ù„Ù€ segments Ø­Ø³Ø¨ strokeId Ù„Ø±Ø³Ù…Ù‡Ø§ Ù…ØªØµÙ„Ø©
const studentStrokes = {}; // strokeId â†’ {ctx, pts, c, s, e, lastX, lastY}

db.ref('studentDraw').on('child_added', snap => {
  const d = snap.val(); if (!d||!d.pts||!d.pts.length) return;

  const key = (d.sid||'x')+'_'+d.id;
  if (!studentStrokes[key]) {
    studentStrokes[key] = { lastX:d.pts[0].x, lastY:d.pts[0].y };
    // Ù†Ù‚Ø·Ø© Ø£ÙˆÙ„Ù‰
    sx.save();
    sx.globalCompositeOperation = d.e?'destination-out':'source-over';
    sx.fillStyle = d.e?'rgba(0,0,0,1)':(d.c||'#000');
    sx.beginPath(); sx.arc(d.pts[0].x,d.pts[0].y,(d.s||3)/2,0,Math.PI*2); sx.fill();
    sx.restore();
  }
  const st = studentStrokes[key];
  sx.save();
  if (d.e) { sx.globalCompositeOperation='destination-out'; sx.strokeStyle='rgba(0,0,0,1)'; sx.lineWidth=30; }
  else     { sx.globalCompositeOperation='source-over';     sx.strokeStyle=d.c||'#000';     sx.lineWidth=d.s||3; }
  sx.lineCap='round'; sx.lineJoin='round';
  sx.beginPath(); sx.moveTo(st.lastX, st.lastY);
  for (const p of d.pts) {
    const mx=(st.lastX+p.x)/2, my=(st.lastY+p.y)/2;
    sx.quadraticCurveTo(st.lastX,st.lastY,mx,my);
    st.lastX=p.x; st.lastY=p.y;
  }
  sx.stroke(); sx.restore();
});

// â”€â”€ Ø£Ø¯ÙˆØ§Øª â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setClr(c,el){clr=c;tool='pen';document.querySelectorAll('.cb').forEach(b=>b.classList.remove('on'));el.classList.add('on');setTool('pen');}
function setSz(s,id){sz=s;document.querySelectorAll('#sz1,#sz2,#sz3').forEach(b=>b.classList.remove('on'));document.getElementById(id).classList.add('on');}
function setTool(t){tool=t;document.getElementById('penBtn').classList.toggle('on',t==='pen');document.getElementById('eraserBtn').classList.toggle('on',t==='eraser');}
function clearT(){tx.clearRect(0,0,2000,1500);}
function clearS(){sx.clearRect(0,0,2000,1500);}
function clearAll(){
  if(!confirm('Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„ØŸ'))return;
  tx.clearRect(0,0,2000,1500); sx.clearRect(0,0,2000,1500);
  db.ref('cmd').push({type:'clear',ts:Date.now()});
}
function toggleLock(){
  studentsCanDraw=!studentsCanDraw;
  db.ref('ctrl').set({studentsCanDraw});
  document.getElementById('lockBtn').style.background=studentsCanDraw?'#27ae60':'#e74c3c';
  document.getElementById('lockIcon').className='fas fa-lock'+(studentsCanDraw?'-open':'');
}

// â”€â”€ AUDIO: Ø§Ù„Ù…Ø¯Ø±Ø³ ÙŠØ¨Ø« â†’ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙŠØ³Ù…Ø¹ÙˆÙ† â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Ø·Ø±ÙŠÙ‚Ø© Ù…ÙˆØ«ÙˆÙ‚Ø©: Ù†ÙƒØªØ¨ blob ÙˆØ§Ø­Ø¯ ÙƒÙ„ 3 Ø«ÙˆØ§Ù†ÙŠ ÙÙŠ path Ø«Ø§Ø¨Øª
// Ø§Ù„Ø·Ø§Ù„Ø¨ ÙŠØ±Ø§Ù‚Ø¨ Ù†ÙØ³ Ø§Ù„Ù€ path ÙˆÙŠØ´ØºÙ„ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ù€ <audio>

function getMime(){
  for(const t of['audio/webm;codecs=opus','audio/webm','audio/ogg;codecs=opus'])
    if(MediaRecorder.isTypeSupported(t))return t;
  return '';
}
function toB64(blob){return new Promise(r=>{const f=new FileReader();f.onloadend=()=>r(f.result);f.readAsDataURL(blob);})}

let audioSlot=0;

function recordOnce(){
  if(!micStream)return;
  const mime=getMime();
  const rec=new MediaRecorder(micStream, mime?{mimeType:mime}:{});
  const chunks=[];
  rec.ondataavailable=ev=>{if(ev.data&&ev.data.size>0)chunks.push(ev.data);};
  rec.onstop=async()=>{
    if(!chunks.length||!micOn)return;
    const blob=new Blob(chunks,{type:mime||'audio/webm'});
    if(blob.size<200)return;
    const b64=await toB64(blob);
    audioSlot = audioSlot===0 ? 1 : 0; // ÙŠØªÙ†Ø§ÙˆØ¨ Ø¨ÙŠÙ† 0 Ùˆ 1
    // set (Ù„Ø§ push) Ø­ØªÙ‰ ÙŠØ·Ù„Ù‚ child_changed Ø¹Ù†Ø¯ Ø§Ù„Ø·Ø§Ù„Ø¨
    db.ref('audio/slot'+audioSlot).set({d:b64,ts:Date.now()});
  };
  rec.start();
  setTimeout(()=>{try{rec.stop();}catch(e){}}, 2800);
}

async function toggleMic(){
  const btn=document.getElementById('micBtn');
  const icon=document.getElementById('micIcon');
  const ind=document.getElementById('micInd');
  if(!micOn){
    icon.className='fas fa-spinner fa-spin'; btn.disabled=true;
    try{
      micStream=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:true,noiseSuppression:true,autoGainControl:true}});
      micOn=true; btn.disabled=false;
      btn.classList.add('mic-on'); icon.className='fas fa-microphone-slash';
      ind.classList.add('on');
      document.getElementById('stEl').textContent='ğŸ¤ Ù…Ø§ÙŠÙƒ Ø´ØºÙ‘Ø§Ù„';
      db.ref('audioMeta').set({active:true,ts:Date.now()});
      recordOnce();
      recInterval=setInterval(recordOnce, 3000);
    }catch(err){
      btn.disabled=false; icon.className='fas fa-microphone';
      alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…Ø§ÙŠÙƒØ±ÙˆÙÙˆÙ†:\n'+err.message);
    }
  }else{
    clearInterval(recInterval); recInterval=null;
    if(micStream)micStream.getTracks().forEach(t=>t.stop());
    micStream=null; micOn=false;
    btn.classList.remove('mic-on'); icon.className='fas fa-microphone';
    ind.classList.remove('on');
    document.getElementById('stEl').textContent='Ù…ØªØµÙ„';
    db.ref('audioMeta').set({active:false});
    db.ref('audio').remove();
  }
}

// â”€â”€ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ ØµÙˆØª Ø§Ù„Ø·Ù„Ø§Ø¨ (Ù„Ù„Ù…Ø¯Ø±Ø³) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const heardTs=new Set();
async function playStudentBlob(d){
  if(!d||!d.d||heardTs.has(d.ts))return;
  heardTs.add(d.ts);
  try{const a=new Audio(d.d); await a.play();}catch(e){}
}
['slot0','slot1'].forEach(slot=>{
  db.ref('studentAudio/'+slot).on('value',snap=>playStudentBlob(snap.val()));
});

// â”€â”€ Ø§Ù„Ø·Ù„Ø§Ø¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
db.ref('onlineStudents').on('value',snap=>{
  const v=snap.val()||{};
  document.getElementById('cnt').textContent=Object.keys(v).length;
  const list=document.getElementById('slist'); list.innerHTML='';
  Object.keys(v).forEach(()=>{
    const c=document.createElement('div'); c.className='chip';
    c.innerHTML='<i class="fas fa-user-graduate"></i> Ø·Ø§Ù„Ø¨'; list.appendChild(c);
  });
});

db.ref('.info/connected').on('value',snap=>{
  document.getElementById('dotEl').className='dot '+(snap.val()?'on':'off');
  document.getElementById('stEl').textContent=snap.val()?'Ù…ØªØµÙ„':'ØºÙŠØ± Ù…ØªØµÙ„';
});

db.ref('teacher/online').set({online:true,ts:Date.now()});
db.ref('ctrl').set({studentsCanDraw:true});
[tc,sc].forEach(c=>c.addEventListener('contextmenu',e=>e.preventDefault()));
</script>
</body>
</html>
