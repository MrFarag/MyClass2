<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>MyClass2 - Ø§Ù„Ù…Ø¯Ø±Ø³</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;overflow:hidden;font-family:'Segoe UI',sans-serif;background:#1a2634;color:#fff;display:flex;flex-direction:column}

/* HEADER */
.hdr{height:48px;min-height:48px;background:#2c3e50;display:flex;align-items:center;justify-content:space-between;padding:0 12px;border-bottom:3px solid #e67e22;flex-shrink:0;gap:8px}
.logo{font-size:15px;font-weight:bold;display:flex;align-items:center;gap:6px}
.logo i{color:#e67e22}
.hdr-right{display:flex;align-items:center;gap:6px;flex-shrink:0}
.badge{padding:4px 10px;border-radius:20px;font-size:12px;display:flex;align-items:center;gap:5px}
.badge.green{background:#27ae60}
.badge.red{background:#e74c3c;animation:pulse 1s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.6}}

/* BOARDS */
.boards{flex:1;display:flex;padding:6px;gap:6px;overflow:hidden;min-height:0}
@media(max-width:768px){.boards{flex-direction:column}}
@media(min-width:769px){.boards{flex-direction:row}}

.board{flex:1;display:flex;flex-direction:column;background:#2c3e50;border-radius:10px;overflow:hidden;min-height:0;border:1px solid #34495e}
.bh{padding:7px 10px;background:#34495e;display:flex;align-items:center;justify-content:space-between;flex-shrink:0;border-bottom:3px solid #e67e22}
.bh.blue{border-bottom-color:#3498db}
.bt{font-size:13px;font-weight:bold;display:flex;align-items:center;gap:5px}
.bh-btns{display:flex;gap:4px}
.bh-btns button{background:rgba(255,255,255,.12);border:none;color:#fff;width:28px;height:28px;border-radius:6px;cursor:pointer;font-size:12px;transition:.2s}
.bh-btns button:hover{background:#e67e22}

/* CANVAS */
.carea{flex:1;overflow:hidden;background:#e0e0e0;position:relative;min-height:0}
.carea canvas{display:block;width:100%;height:100%;background:#fff;touch-action:none;cursor:crosshair}

/* TOOLBAR */
.tb{height:56px;min-height:56px;background:#2c3e50;border-top:2px solid #e67e22;display:flex;align-items:center;padding:0 8px;gap:6px;flex-shrink:0;overflow-x:auto}
.tb::-webkit-scrollbar{height:0}
.tg{display:flex;gap:3px;background:#1a2634;padding:4px 6px;border-radius:20px;align-items:center;flex-shrink:0}
.cb{width:26px;height:26px;border-radius:50%;border:3px solid transparent;cursor:pointer;transition:.15s;flex-shrink:0}
.cb.active,.cb:hover{border-color:#fff;transform:scale(1.15)}
.tb-btn{width:36px;height:36px;border:none;border-radius:8px;background:#34495e;color:#fff;font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:.2s}
.tb-btn:hover,.tb-btn.active{background:#e67e22}
.tb-btn.red{background:#c0392b}
.tb-btn.red:hover{background:#e74c3c}
.tb-btn.mic-on{background:#e74c3c !important;animation:pulseMic 1.5s infinite}
@keyframes pulseMic{0%,100%{box-shadow:0 0 0 0 rgba(231,76,60,.6)}50%{box-shadow:0 0 0 8px rgba(231,76,60,0)}}

/* SIZE DOTS */
.sdot{background:#fff;border-radius:50%}

/* STATUS */
.sbar{height:34px;min-height:34px;background:#111b27;border-top:1px solid #243447;display:flex;align-items:center;justify-content:space-between;padding:0 12px;font-size:12px;color:#aab8c8;flex-shrink:0}
.sdot2{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.sdot2.on{background:#27ae60;box-shadow:0 0 6px #27ae60}
.sdot2.off{background:#e74c3c}

/* STUDENTS */
.stud-panel{background:#1e2d3d;border-top:1px solid #243447;max-height:50px;overflow-y:auto;padding:4px 10px;flex-shrink:0}
.stud-list{display:flex;flex-wrap:wrap;gap:5px}
.schip{background:#34495e;padding:3px 10px;border-radius:20px;font-size:11px;display:flex;align-items:center;gap:5px;border-right:3px solid #27ae60}
.schip button{background:none;border:none;color:#ccc;cursor:pointer}

/* MIC indicator */
.mic-ind{display:none;align-items:center;gap:5px;background:#e74c3c;padding:4px 10px;border-radius:20px;font-size:12px}
.mic-ind.show{display:flex}
</style>
</head>
<body>

<div class="hdr">
  <div class="logo"><i class="fas fa-chalkboard-teacher"></i> MyClass2 â€” Ø§Ù„Ù…Ø¯Ø±Ø³</div>
  <div class="hdr-right">
    <div class="mic-ind" id="micInd"><i class="fas fa-microphone"></i> Ù…Ø§ÙŠÙƒ Ø´ØºÙ‘Ø§Ù„</div>
    <div class="badge green"><i class="fas fa-users"></i> <span id="cnt">0</span></div>
  </div>
</div>

<div class="boards">
  <!-- Ø³Ø¨ÙˆØ±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ -->
  <div class="board">
    <div class="bh">
      <span class="bt"><i class="fas fa-pen-fancy" style="color:#e67e22"></i> Ø³Ø¨ÙˆØ±ØªÙŠ</span>
      <div class="bh-btns">
        <button onclick="clearBoard('t')" title="Ù…Ø³Ø­"><i class="fas fa-eraser"></i></button>
      </div>
    </div>
    <div class="carea" id="tArea"><canvas id="tCanvas"></canvas></div>
  </div>

  <!-- Ø³Ø¨ÙˆØ±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ -->
  <div class="board">
    <div class="bh blue">
      <span class="bt"><i class="fas fa-users" style="color:#3498db"></i> Ø³Ø¨ÙˆØ±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</span>
      <div class="bh-btns">
        <button onclick="clearBoard('s')" title="Ù…Ø³Ø­"><i class="fas fa-eraser"></i></button>
      </div>
    </div>
    <div class="carea" id="sArea"><canvas id="sCanvas"></canvas></div>
  </div>
</div>

<div class="tb">
  <!-- Ø£Ù„ÙˆØ§Ù† -->
  <div class="tg">
    <div class="cb active" style="background:#1a1a1a" onclick="setColor('#1a1a1a',this)"></div>
    <div class="cb" style="background:#e74c3c" onclick="setColor('#e74c3c',this)"></div>
    <div class="cb" style="background:#2980b9" onclick="setColor('#2980b9',this)"></div>
    <div class="cb" style="background:#27ae60" onclick="setColor('#27ae60',this)"></div>
    <div class="cb" style="background:#8e44ad" onclick="setColor('#8e44ad',this)"></div>
    <div class="cb" style="background:#e67e22" onclick="setColor('#e67e22',this)"></div>
    <div class="cb" style="background:#fff;border:2px solid #888" onclick="setColor('#ffffff',this)"></div>
  </div>
  <!-- Ø£Ø­Ø¬Ø§Ù… -->
  <div class="tg">
    <button class="tb-btn active" id="sz1" onclick="setSize(2,'sz1')"><div class="sdot" style="width:4px;height:4px"></div></button>
    <button class="tb-btn" id="sz2" onclick="setSize(5,'sz2')"><div class="sdot" style="width:8px;height:8px"></div></button>
    <button class="tb-btn" id="sz3" onclick="setSize(12,'sz3')"><div class="sdot" style="width:14px;height:14px"></div></button>
  </div>
  <!-- Ø£Ø¯ÙˆØ§Øª -->
  <div class="tg">
    <button class="tb-btn active" id="penBtn" onclick="setTool('pen')" title="Ù‚Ù„Ù…"><i class="fas fa-pencil-alt"></i></button>
    <button class="tb-btn" id="eraserBtn" onclick="setTool('eraser')" title="Ù…Ù…Ø­Ø§Ø©"><i class="fas fa-eraser"></i></button>
    <button class="tb-btn red" onclick="clearAll()" title="Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„"><i class="fas fa-trash-alt"></i></button>
  </div>
  <!-- ØªØ­ÙƒÙ… -->
  <div class="tg">
    <button class="tb-btn" id="audioBtn" onclick="toggleMic()" title="Ù…Ø§ÙŠÙƒØ±ÙˆÙÙˆÙ†"><i class="fas fa-microphone" id="micIcon"></i></button>
    <button class="tb-btn" id="lockBtn" onclick="toggleLock()" title="ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø·Ù„Ø§Ø¨" style="background:#27ae60"><i class="fas fa-lock-open" id="lockIcon"></i></button>
  </div>
</div>

<div class="stud-panel"><div class="stud-list" id="studList"></div></div>

<div class="sbar">
  <div style="display:flex;align-items:center;gap:6px">
    <span class="sdot2 on" id="dotEl"></span>
    <span id="statusEl">Ù…ØªØµÙ„</span>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script>
// â”€â”€â”€ Firebase â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
firebase.initializeApp({
  apiKey:"AIzaSyB7E4NsGQbCehVSQ3Kj97yExRZwpHzTOl8",
  authDomain:"myclaive.firebaseapp.com",
  databaseURL:"https://myclaive-default-rtdb.firebaseio.com",
  projectId:"myclaive",
  storageBucket:"myclaive.firebasestorage.app",
  messagingSenderId:"507299311714",
  appId:"1:507299311714:web:c90440ee4353cfac17613b"
});
const db = firebase.database();

// â”€â”€â”€ Canvas setup â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const tCanvas = document.getElementById('tCanvas');
const sCanvas = document.getElementById('sCanvas');
const tCtx    = tCanvas.getContext('2d');
const sCtx    = sCanvas.getContext('2d');
const tArea   = document.getElementById('tArea');
const sArea   = document.getElementById('sArea');

// Ù‚ÙŠØ§Ø³Ø§Øª Ø¯Ø§Ø®Ù„ÙŠØ© (Ø«Ø§Ø¨ØªØ© Ù„Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù…ÙØ±Ø³ÙŽÙ„Ø©)
const W = 1600, H = 1200;

function resizeCanvas(canvas, area) {
  const w = area.clientWidth, h = area.clientHeight;
  canvas.style.width  = w + 'px';
  canvas.style.height = h + 'px';
}

function initCanvases() {
  tCanvas.width  = W; tCanvas.height  = H;
  sCanvas.width  = W; sCanvas.height  = H;
  resizeCanvas(tCanvas, tArea);
  resizeCanvas(sCanvas, sArea);
  [tCtx, sCtx].forEach(c => {
    c.lineCap = 'round'; c.lineJoin = 'round';
  });
}
initCanvases();
window.addEventListener('resize', () => {
  resizeCanvas(tCanvas, tArea);
  resizeCanvas(sCanvas, sArea);
});

// â”€â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let tool  = 'pen';
let color = '#1a1a1a';
let size  = 2;
let drawing = false;
let lx = 0, ly = 0;
let studentsCanDraw = true;
let micOn = false;
let micStream = null;
let mediaRec  = null;
let chunkRef  = null;
let chunkIdx  = 0;

// â”€â”€â”€ Coordinate helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getXY(e, canvas, area) {
  const rect = area.getBoundingClientRect();
  let cx = e.touches ? e.touches[0].clientX : e.clientX;
  let cy = e.touches ? e.touches[0].clientY : e.clientY;
  // ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„ÙƒØ§Ù†ÙØ§Ø³ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©
  return {
    x: ((cx - rect.left) / rect.width)  * W,
    y: ((cy - rect.top)  / rect.height) * H
  };
}

// â”€â”€â”€ Drawing on teacher board â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function applyStroke(ctx, x1, y1, x2, y2, col, sz, erase) {
  ctx.save();
  if (erase) {
    ctx.globalCompositeOperation = 'destination-out';
    ctx.strokeStyle = 'rgba(0,0,0,1)';
    ctx.lineWidth   = 40;
  } else {
    ctx.globalCompositeOperation = 'source-over';
    ctx.strokeStyle = col;
    ctx.lineWidth   = sz;
  }
  ctx.lineCap  = 'round';
  ctx.lineJoin = 'round';
  ctx.beginPath();
  ctx.moveTo(x1, y1);
  // smooth
  const mx = (x1+x2)/2, my = (y1+y2)/2;
  ctx.quadraticCurveTo(x1, y1, mx, my);
  ctx.stroke();
  ctx.restore();
}

function startT(e) {
  e.preventDefault();
  drawing = true;
  const p = getXY(e, tCanvas, tArea);
  lx = p.x; ly = p.y;
}
function moveT(e) {
  e.preventDefault();
  if (!drawing) return;
  const p = getXY(e, tCanvas, tArea);
  applyStroke(tCtx, lx, ly, p.x, p.y, color, size, tool==='eraser');
  // Ø¥Ø±Ø³Ø§Ù„
  db.ref('tDraw').push({
    x:p.x, y:p.y, lx, ly,
    c: tool==='eraser' ? null : color,
    s: tool==='eraser' ? null : size,
    e: tool==='eraser' ? 1 : 0,
    ts: Date.now()
  });
  lx = p.x; ly = p.y;
}
function stopT() { drawing = false; }

tCanvas.addEventListener('mousedown', startT);
tCanvas.addEventListener('mousemove', moveT);
tCanvas.addEventListener('mouseup',   stopT);
tCanvas.addEventListener('mouseleave',stopT);
tCanvas.addEventListener('touchstart',startT,{passive:false});
tCanvas.addEventListener('touchmove', moveT, {passive:false});
tCanvas.addEventListener('touchend',  stopT);

// â”€â”€â”€ Drawing on student board â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function startS(e) { e.preventDefault(); drawing=true; const p=getXY(e,sCanvas,sArea); lx=p.x; ly=p.y; }
function moveS(e) {
  e.preventDefault();
  if (!drawing) return;
  const p = getXY(e, sCanvas, sArea);
  applyStroke(sCtx, lx, ly, p.x, p.y, color, size, tool==='eraser');
  db.ref('sDraw').push({ x:p.x, y:p.y, lx, ly, c:tool==='eraser'?null:color, s:tool==='eraser'?null:size, e:tool==='eraser'?1:0, ts:Date.now() });
  lx = p.x; ly = p.y;
}
function stopS() { drawing = false; }

sCanvas.addEventListener('mousedown', startS);
sCanvas.addEventListener('mousemove', moveS);
sCanvas.addEventListener('mouseup',   stopS);
sCanvas.addEventListener('mouseleave',stopS);
sCanvas.addEventListener('touchstart',startS,{passive:false});
sCanvas.addEventListener('touchmove', moveS, {passive:false});
sCanvas.addEventListener('touchend',  stopS);

// â”€â”€â”€ Receive student drawing â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let lastStudentKey = null;
db.ref('studentDraw').on('child_added', snap => {
  if (snap.key === lastStudentKey) return;
  lastStudentKey = snap.key;
  const d = snap.val();
  if (!d) return;
  applyStroke(sCtx, d.lx, d.ly, d.x, d.y, d.c||'#000', d.s||3, !!d.e);
});

// â”€â”€â”€ Tool controls â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setColor(c, el) {
  color = c; tool = 'pen';
  document.querySelectorAll('.cb').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  setTool('pen');
}
function setSize(s, id) {
  size = s;
  document.querySelectorAll('#sz1,#sz2,#sz3').forEach(b=>b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}
function setTool(t) {
  tool = t;
  document.getElementById('penBtn').classList.toggle('active', t==='pen');
  document.getElementById('eraserBtn').classList.toggle('active', t==='eraser');
}
function clearBoard(which) {
  if (which === 't') tCtx.clearRect(0,0,W,H);
  else               sCtx.clearRect(0,0,W,H);
}
function clearAll() {
  if (!confirm('Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø³Ø¨ÙˆØ±Ø§ØªØŸ')) return;
  tCtx.clearRect(0,0,W,H);
  sCtx.clearRect(0,0,W,H);
  db.ref('cmd').push({ t:'clear', ts:Date.now() });
}
function toggleLock() {
  studentsCanDraw = !studentsCanDraw;
  db.ref('ctrl').set({ canDraw: studentsCanDraw });
  document.getElementById('lockBtn').style.background = studentsCanDraw ? '#27ae60' : '#e74c3c';
  document.getElementById('lockIcon').className = 'fas fa-lock' + (studentsCanDraw?'-open':'');
}

// â”€â”€â”€ Microphone â€” Ø¨Ø« Ø¨Ù€ base64 chunks ØµØºÙŠØ±Ø© (500ms) â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function toggleMic() {
  if (!micOn) {
    try {
      document.getElementById('micIcon').className = 'fas fa-spinner fa-spin';
      micStream = await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:true,noiseSuppression:true}});
      micOn = true;

      // Ø£Ø¹Ù„Ù† Ù„Ù„Ø·Ù„Ø§Ø¨
      db.ref('audioMeta').set({ active:true, ts:Date.now() });

      chunkRef = db.ref('audioChunks');
      chunkIdx = 0;

      // Ø§Ø­Ø°Ù Ø§Ù„Ù‚Ø¯ÙŠÙ…
      chunkRef.remove();

      mediaRec = new MediaRecorder(micStream, { mimeType: getSupportedMimeType() });
      mediaRec.ondataavailable = async ev => {
        if (!ev.data || ev.data.size === 0) return;
        const b64 = await blobToBase64(ev.data);
        // Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø¢Ø®Ø± 10 chunks ÙÙ‚Ø· ÙÙŠ Firebase (Ù„Ø§ ØªØªØ±Ø§ÙƒÙ…)
        chunkRef.child(String(chunkIdx % 10)).set({ d: b64, i: chunkIdx, ts: Date.now() });
        chunkIdx++;
      };
      mediaRec.start(500); // ÙƒÙ„ 500ms chunk

      document.getElementById('audioBtn').classList.add('mic-on');
      document.getElementById('micIcon').className = 'fas fa-microphone-slash';
      document.getElementById('micInd').classList.add('show');
      document.getElementById('statusEl').textContent = 'ðŸŽ¤ Ø§Ù„Ù…Ø§ÙŠÙƒ Ø´ØºÙ‘Ø§Ù„';
    } catch(err) {
      document.getElementById('micIcon').className = 'fas fa-microphone';
      alert('ØªØ¹Ø°Ù‘Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…Ø§ÙŠÙƒ: ' + err.message);
    }
  } else {
    if (mediaRec && mediaRec.state !== 'inactive') mediaRec.stop();
    if (micStream) micStream.getTracks().forEach(t=>t.stop());
    mediaRec = null; micStream = null; micOn = false; chunkIdx = 0;
    db.ref('audioMeta').set({ active:false });
    db.ref('audioChunks').remove();
    document.getElementById('audioBtn').classList.remove('mic-on');
    document.getElementById('micIcon').className = 'fas fa-microphone';
    document.getElementById('micInd').classList.remove('show');
    document.getElementById('statusEl').textContent = 'Ù…ØªØµÙ„';
  }
}

function getSupportedMimeType() {
  const types = ['audio/webm;codecs=opus','audio/webm','audio/ogg;codecs=opus','audio/mp4'];
  for (const t of types) if (MediaRecorder.isTypeSupported(t)) return t;
  return '';
}

function blobToBase64(blob) {
  return new Promise(res => {
    const r = new FileReader();
    r.onloadend = () => res(r.result);
    r.readAsDataURL(blob);
  });
}

// â”€â”€â”€ Students panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
db.ref('online').on('value', snap => {
  const v = snap.val() || {};
  const list = document.getElementById('studList');
  const cnt  = document.getElementById('cnt');
  list.innerHTML = '';
  const keys = Object.keys(v);
  cnt.textContent = keys.length;
  keys.forEach(k => {
    const ch = document.createElement('div');
    ch.className = 'schip';
    ch.innerHTML = `<i class="fas fa-user-graduate"></i> Ø·Ø§Ù„Ø¨`;
    list.appendChild(ch);
  });
});

// â”€â”€â”€ Connection â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
db.ref('.info/connected').on('value', snap => {
  const el = document.getElementById('dotEl');
  document.getElementById('statusEl').textContent = snap.val() ? 'Ù…ØªØµÙ„' : 'ØºÙŠØ± Ù…ØªØµÙ„...';
  el.className = 'sdot2 ' + (snap.val() ? 'on' : 'off');
});

db.ref('ctrl').set({ canDraw: true });
[tCanvas,sCanvas].forEach(c=>c.addEventListener('contextmenu',e=>e.preventDefault()));
</script>
</body>
</html>
