<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>MyClass2 - Ø§Ù„Ø³Ø¨ÙˆØ±Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root{
    --bl:#3b82f6;--rd:#ef4444;--gn:#22c55e;--yw:#f59e0b;--dk:#0f172a;--cd:#1e293b;--br:#334155;--mt:#475569;--dm:#94a3b8;
    --board-bg: #fdfbf7; /* Ù„ÙˆÙ† ÙƒØ±ÙŠÙ…ÙŠ Ù…Ù„ÙƒÙŠ */
    --board-border: #d1d5db;
}
*{margin:0;padding:0;box-sizing:border-box;font-family:'Cairo',sans-serif}
html,body{height:100%;overflow:hidden;background:var(--dk);color:#fff}

.hdr{background:var(--cd);height:50px;padding:0 14px;display:flex;align-items:center;justify-content:space-between;border-bottom:2px solid var(--br);flex-shrink:0;z-index:10}
.logo{font-size:19px;font-weight:900;color:var(--bl)}.logo span{color:#fff}
.hstats{display:flex;gap:8px}
.chip{background:var(--br);padding:4px 12px;border-radius:20px;font-size:12px;display:flex;align-items:center;gap:6px}
.live{background:var(--rd);padding:4px 12px;border-radius:20px;font-size:12px;display:flex;align-items:center;gap:6px;animation:blink 1.5s infinite}

@keyframes blink{0%,100%{opacity:1}50%{opacity:.6}}

#shell{display:flex;flex-direction:column;height:calc(100vh - 50px)}
.main{display:flex;flex:1;overflow:hidden;min-height:0;background: #111827;}

/* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø³Ø¨ÙˆØ±Ø© Ø§Ù„ÙˆØ§Ù‚Ø¹ÙŠ */
.content{flex:1;display:flex;flex-direction:column;overflow:hidden;min-height:0;padding:15px;background: #1e293b;}
.bwrap{
    flex:1;
    background:var(--board-bg);
    position:relative;
    overflow:hidden;
    border-radius:12px;
    border: 8px solid #475569; /* Ø¥Ø·Ø§Ø± Ø§Ù„Ø³Ø¨ÙˆØ±Ø© */
    box-shadow: 
        inset 0 0 15px rgba(0,0,0,0.1), 
        0 10px 25px rgba(0,0,0,0.3);
}
#mc{display:block;position:absolute;top:0;left:0;width:100%;height:100%;touch-action:none;cursor:crosshair}

.sidebar{width:220px;background:var(--cd);border-left:1px solid var(--br);display:flex;flex-direction:column;flex-shrink:0}
.sdt{padding:12px;font-size:12px;color:var(--bl);border-bottom:1px solid var(--br);font-weight:900;text-align:center;letter-spacing:1px}
.slist{flex:1;overflow-y:auto;padding:8px}
.sitem{padding:10px;border-radius:12px;cursor:pointer;margin-bottom:6px;background: rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.05);transition:.2s}
.sitem:hover{background:rgba(59,130,246,0.1)}
.sitem.act{background:var(--bl);border-color:var(--bl);box-shadow: 0 4px 12px rgba(59,130,246,0.3)}
.sitem.act .sname, .sitem.act .slbl{color:#fff}
.sname{font-size:13px;font-weight:700;display:block;color:#e2e8f0;overflow:hidden;text-overflow:ellipsis}
.sbadges{display:flex;align-items:center;gap:6px;margin-top:4px}
.sdot{width:7px;height:7px;border-radius:50%;background:var(--gn)}
.slbl{font-size:10px;color:var(--dm)}

.toolbar{background:var(--cd);padding:10px;display:flex;align-items:center;gap:10px;justify-content:center;border-top:1px solid var(--br)}
.tb{width:42px;height:42px;border-radius:10px;background:var(--br);color:var(--dm);border:none;cursor:pointer;transition:.2s}
.tb.on{background:var(--bl);color:#fff;transform:scale(1.1)}
.tb:hover:not(.on){background:var(--mt);color:#fff}

.statusbar{background:var(--cd);height:30px;padding:0 15px;display:flex;align-items:center;justify-content:space-between;font-size:11px;color:var(--dm);border-top:1px solid var(--br)}

#txtbox{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:1000;align-items:center;justify-content:center;backdrop-filter:blur(4px)}
.txtin{background:var(--cd);padding:25px;border-radius:20px;width:320px;border:1px solid var(--bl)}
.txtin input{width:100%;padding:12px;background:var(--dk);border:1px solid var(--br);border-radius:10px;color:#fff;margin:15px 0}
</style>
</head>
<body>
<div class="hdr">
  <div class="logo">My<span>Class</span>2</div>
  <div class="hstats">
    <div class="chip"><i class="fas fa-users"></i><span id="cnt">0</span></div>
    <div class="chip"><i class="fas fa-hand-paper" style="color:var(--yw)"></i><span id="hcnt">0</span></div>
    <div class="live"><i class="fas fa-circle"></i> Ù…Ø¨Ø§Ø´Ø±</div>
  </div>
</div>
<div id="shell">
  <div class="main">
    <div class="content">
      <div class="bwrap" id="bwrap">
        <canvas id="mc"></canvas>
        <div class="blabel" id="blabel" style="position:absolute; top:10px; left:10px; color:#64748b; font-weight:700; font-size:12px; opacity:0.5">Ø§Ù„Ø³Ø¨ÙˆØ±Ø© Ø§Ù„Ø°ÙƒÙŠØ©</div>
      </div>
      <div class="toolbar">
        <button class="tb on" id="bpen" onclick="setTool('pen')"><i class="fas fa-pencil-alt"></i></button>
        <button class="tb" id="bera" onclick="setTool('eraser')"><i class="fas fa-eraser"></i></button>
        <div style="width:2px; height:30px; background:var(--br)"></div>
        <div id="clrs" style="display:flex; gap:6px">
            <div onclick="setClr('#1e293b',this)" class="cl" style="width:25px;height:25px;border-radius:50%;background:#1e293b;cursor:pointer;border:2px solid #fff"></div>
            <div onclick="setClr('#ef4444',this)" class="cl" style="width:25px;height:25px;border-radius:50%;background:#ef4444;cursor:pointer"></div>
            <div onclick="setClr('#3b82f6',this)" class="cl" style="width:25px;height:25px;border-radius:50%;background:#3b82f6;cursor:pointer"></div>
        </div>
        <button class="tb danger" onclick="clearBoard()" style="margin-right:20px; color:var(--rd)"><i class="fas fa-trash"></i></button>
      </div>
    </div>
    <div class="sidebar">
      <div class="sdt">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</div>
      <div class="slist" id="slist">
        <div style="color:var(--dm);font-size:12px;text-align:center;padding:20px">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø·Ù„Ø§Ø¨...</div>
      </div>
    </div>
  </div>
  <div class="statusbar">
    <span>Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¯Ø±Ø³ Ø§Ù„Ù…ØªØµÙ„ <i class="fas fa-check-circle" style="color:var(--gn)"></i></span>
    <span id="lat">32ms</span>
  </div>
</div>

<div id="txtbox">
  <div class="txtin">
    <h3 style="text-align:center">Ø¥Ø¶Ø§ÙØ© Ù†Øµ Ù„Ù„Ø³Ø¨ÙˆØ±Ø©</h3>
    <input id="txtin" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§...">
    <div style="display:flex; gap:10px">
      <button onclick="confirmText()" style="flex:1; padding:10px; background:var(--bl); border:none; border-radius:10px; color:#fff; cursor:pointer">Ø¥Ø¶Ø§ÙØ©</button>
      <button onclick="document.getElementById('txtbox').style.display='none'" style="flex:1; padding:10px; background:var(--br); border:none; border-radius:10px; color:#fff; cursor:pointer">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script>
firebase.initializeApp({
  apiKey:"AIzaSyB7E4NsGQbCehVSQ3Kj97yExRZwpHzTOl8",
  authDomain:"myclaive.firebaseapp.com",
  databaseURL:"https://myclaive-default-rtdb.firebaseio.com",
  projectId:"myclaive",
  storageBucket:"myclaive.firebasestorage.app",
  messagingSenderId:"507299311714",
  appId:"1:507299311714:web:c90440ee4353cfac17613b"
});
const db=firebase.database();

// â”€â”€ Ø§Ù„Ø­Ù„ Ø§Ù„Ø¬Ø°Ø±ÙŠ Ù„Ù„Ø£Ø³Ù…Ø§Ø¡: ØªØµÙÙŠØ± Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø¹Ù†Ø¯ Ø§Ù„ØªØ´ØºÙŠÙ„ â”€â”€
db.ref('onlineStudents').remove();
db.ref('approvedStudents').remove();
db.ref('joinRequests').remove();
db.ref('handRaised').remove();
db.ref('micRequests').remove();

let students={}, curView='main', tool='pen', clr='#1e293b', sz=4, down=false;
const canvas=document.getElementById('mc'), ctx=canvas.getContext('2d');

function fitMain(){
  const w=canvas.parentElement.offsetWidth, h=canvas.parentElement.offsetHeight;
  canvas.width=w; canvas.height=h;
  ctx.fillStyle='#fdfbf7'; // Ø§Ù„Ù„ÙˆÙ† Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ
  ctx.fillRect(0,0,w,h);
}
window.addEventListener('resize', fitMain);
setTimeout(fitMain, 100);

// â”€â”€ Ù…Ù†Ø·Ù‚ Ø§Ù„Ø±Ø³Ù… â”€â”€
function getXY(e){
  const r=canvas.getBoundingClientRect();
  const ex=e.touches?e.touches[0].clientX:e.clientX;
  const ey=e.touches?e.touches[0].clientY:e.clientY;
  return{x:(ex-r.left)*(canvas.width/r.width), y:(ey-r.top)*(canvas.height/r.height)};
}

canvas.addEventListener('mousedown', (e)=>{
    down=true; const p=getXY(e);
    ctx.beginPath(); ctx.moveTo(p.x, p.y);
});
canvas.addEventListener('mousemove', (e)=>{
    if(!down) return;
    const p=getXY(e);
    ctx.lineWidth = tool==='eraser'? 30 : sz;
    ctx.strokeStyle = tool==='eraser'? '#fdfbf7' : clr;
    ctx.lineCap = 'round'; ctx.lineJoin='round';
    ctx.lineTo(p.x, p.y); ctx.stroke();
    streamPt(p.x, p.y);
});
canvas.addEventListener('mouseup', ()=>{down=false; endStroke();});

function streamPt(x,y){
    const ref = curView==='main' ? db.ref('stroke/T') : db.ref('stroke/TS/'+curView);
    ref.push({x:x/canvas.width, y:y/canvas.height, c:clr, t:tool});
}

function endStroke(){
    const jpg = canvas.toDataURL('image/jpeg', 0.5);
    db.ref('boardImg/main').set({data:jpg, ts:Date.now()});
}

function setTool(t){
    tool=t;
    document.getElementById('bpen').classList.toggle('on', t==='pen');
    document.getElementById('bera').classList.toggle('on', t==='eraser');
}

function setClr(c, el){
    clr=c;
    document.querySelectorAll('.cl').forEach(i=>i.style.border='none');
    el.style.border='2px solid #fff';
}

function clearBoard(){
    ctx.fillStyle='#fdfbf7'; ctx.fillRect(0,0,canvas.width,canvas.height);
    db.ref('boardCmd').push({type:'clear'});
    endStroke();
}

// â”€â”€ ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ (Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† ÙØ¹Ù„ÙŠØ§Ù‹ ÙÙ‚Ø·) â”€â”€
db.ref('onlineStudents').on('value', snap=>{
    const data = snap.val()||{};
    students = data;
    renderList();
});

function renderList(){
    const list=document.getElementById('slist');
    const keys = Object.keys(students);
    document.getElementById('cnt').textContent = keys.length;
    
    if(keys.length===0){
        list.innerHTML = '<div style="color:var(--dm);font-size:12px;text-align:center;padding:20px">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ù…ØªØµÙ„ÙŠÙ†</div>';
        return;
    }

    let h = `<div class="sitem ${curView==='main'?'act':''}" onclick="curView='main';renderList()">
                <span class="sname">ğŸ–¥ Ø§Ù„Ø³Ø¨ÙˆØ±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
             </div>`;
             
    keys.forEach(id=>{
        h += `<div class="sitem ${curView===id?'act':''}" onclick="curView='${id}';renderList()">
                <span class="sname">${students[id].name || 'Ø·Ø§Ù„Ø¨ Ù…Ø¬Ù‡ÙˆÙ„'}</span>
                <div class="sbadges"><div class="sdot"></div><span class="slbl">Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†</span></div>
              </div>`;
    });
    list.innerHTML = h;
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„Ø§ØªÙ†Ø³ÙŠ Ø§Ù„ÙˆÙ‡Ù…ÙŠ Ù„Ù„Ø¬Ù…Ø§Ù„ÙŠØ©
setInterval(()=>{document.getElementById('lat').textContent=Math.floor(Math.random()*20+20)+'ms';}, 3000);
</script>
</body>
</html>
